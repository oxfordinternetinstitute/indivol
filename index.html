<html>
	<head>
		<script src="js/jquery-3.4.1.js"></script>
		<script language="javascript">
		$(function(){
			$(".vas-scale").click(function(e) {
				var posX = $(this).offset().left, posY = $(this).offset().top;
				var val=e.pageY - posY;
				//console.log(val);
				$(this).children("input").val(val);
				$(this).children(".vas-dot").show().css({"margin-top":val-8});
			});

			$(".next").click(function(e) {
				var v=$("#vas_value").val();
				if (v=="NA") {
					return false;
				}
				//console.log(v);
				if (current_q<questions.length) {
					questions[current_q]["val"]=v;
				}
				loadnextvasq();
			});

			function loadnextvasq(){
				var i=++current_q;
				if (i<questions.length){
					loadvasq(questions[i]["qtext"],questions[i]["qtext2"],questions[i]["label1"],questions[i]["label2"]);
				} else {
					console.log(questions); 
					//TODO: Save questions to server with unqiue user id.
					//TODO: Send to post-experiment questionaire
				}

			}

			function loadvasq(qtext,qtext2,label1="Strongly agree",label2="Strongly disagree",social_info="") {
				$("#qtext").text(qtext);
				$("#qtext2").text(qtext2);
				$("#label1").text(label1);
				$("#label2").text(label2);
				$(".vas-dot").hide();
				//TODO: Social info
			}

			function shuffle(array) {
				var currentIndex = array.length, temporaryValue, randomIndex;

				// While there remain elements to shuffle...
				while (0 !== currentIndex) {

					// Pick a remaining element...
					randomIndex = Math.floor(Math.random() * currentIndex);
					currentIndex -= 1;

					// And swap it with the current element.
					temporaryValue = array[currentIndex];
					array[currentIndex] = array[randomIndex];
					array[randomIndex] = temporaryValue;
				}

				return array;
			}

			function init(){
		
				var raw_qs=[
					"The government should be doing more to tackle climate change",
					"The government should take more steps to reduce social inequality",
					"The government should do more to protect human rights regardless of race, religion etc.",
					"More should be done to reach gender equality",
					"It is important to ensure LGBTQ+ people have the same rights as other members of society",
					"The government should reduce the level of immigration into Britain",
					"NHS patients' data should be made available for academic medical research",
					"Social media sites should not display false news stories on their websites",
					"I would support action to tackle online hate speech"
					//Leaving the EU will be positive for the United Kingdom
				];
				raw_qs=shuffle(raw_qs);
				
				var questions=[];
				var id=0;
				for (var i=0; i<raw_qs.length; i++){
					var q=raw_qs[i];
					questions.push({id:id++, qtext:q, qtext2:"How much do you agree with the following?", label1:"Strongly agree",label2:"Strongly disagree"});
					questions.push({id:id++, qtext:q, qtext2:"How important is this issue to the UK?", label1:"Very important", label2:"Not important at all"});
				}
				//This question is always last
				questions.push({id:questions.length, qtext:"Leaving the EU will be positive for the United Kingdom", qtext2:"How much do you agree with the following?", label1:"Strongly agree",label2:"Strongly disagree"})
				questions.push({id:questions.length, qtext:"Leaving the EU will be positive for the United Kingdom", qtext2:"How important is this issue to the UK?", label1:"Very important", label2:"Not important at all"});
				return questions;
				//TODO: Fix so that "id" property is constant and not suffled
			}
			var current_q=-1; //start at -1 
			var questions=init();
			loadnextvasq();

		});
		</script>
		<link rel="stylesheet" href="css/vas.css" type="text/css" media="screen" />
		<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" />
	</head>
	<body>
		
		<h1 id="qtext2">How strongly do you agree?</h1>
		<h2 id="qtext">This is awesome</h2>

		<div class="vas">
			<div class="vas-label" id="label1">Strongly agree</div>
			<div class="vas-scale">
				<div class="vas-line"></div>
				<div class="vas-dot"></div>
				<input type="hidden" id="vas_value" name="vas_value" value="NA">
			</div>
			<div class="vas-label" id="label2">Strongly disagree</div>
		</div>

		<div class="next"><a href="javascript:void(0);">Next</a></div>

	</body>
</html>